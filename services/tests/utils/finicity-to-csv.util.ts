import * as jsonexport from "jsonexport";

const rawTxns = {
  found: 8,
  displaying: 8,
  moreAvailable: "false",
  fromDate: "1621794246",
  toDate: "1638209933",
  sort: "desc",
  transactions: [
    {
      id: 17190189446,
      amount: -69.22,
      accountId: 5035448261,
      customerId: 5017716956,
      status: "active",
      description: "ZEF CICCHETTI &amp; RA617-3762522  M",
      memo: "DBT Purchase",
      type: "directDebit",
      postedDate: 1637924400,
      transactionDate: 1637924400,
      createdDate: 1638028318,
      categorization: {
        normalizedPayeeName: "Cicchetti",
        category: "Restaurants",
        bestRepresentation: "ZEF CICCHETTI AMP RA DBT PURCHASE",
        country: "USA",
      },
    },
    {
      id: 17082708734,
      amount: -143.25,
      accountId: 5035448261,
      customerId: 5017716956,
      status: "active",
      description: "ROZAFA BISTRO     QUINCY       M",
      memo: "DBT Purchase",
      type: "directDebit",
      postedDate: 1637665200,
      transactionDate: 1637665200,
      createdDate: 1637788450,
      categorization: {
        normalizedPayeeName: "Rozafa",
        category: "Restaurants",
        bestRepresentation: "ROZAFA BISTRO QUINCY DBT PURCHASE",
        country: "USA",
      },
    },
    {
      id: 16859693705,
      amount: -12.67,
      accountId: 5035448261,
      customerId: 5017716956,
      status: "active",
      description: "WALGREENS STORE 55QUINCY       M",
      memo: "POS Debit",
      type: "pointOfSale",
      postedDate: 1637233200,
      transactionDate: 1637233200,
      createdDate: 1637346652,
      lastUpdatedDate: 1637601080,
      categorization: {
        normalizedPayeeName: "Walgreens",
        category: "Pharmacy",
        bestRepresentation: "WALGREENS STORE QUINCY POS DEBIT",
        country: "USA",
      },
    },
    {
      id: 16703387251,
      amount: -9.95,
      accountId: 5035448261,
      customerId: 5017716956,
      status: "active",
      description: "DIGITAL NEWSPAPER 877-5782716  N",
      memo: "DBT Purchase",
      type: "directDebit",
      postedDate: 1636974000,
      transactionDate: 1636974000,
      createdDate: 1637100342,
      lastUpdatedDate: 1637601080,
      categorization: {
        normalizedPayeeName: "Digital Newspaper",
        category: "Newspapers & Magazines",
        bestRepresentation: "DIGITAL NEWSPAPER DBT PURCHASE",
        country: "USA",
      },
    },
    {
      id: 16703387252,
      amount: -226.44,
      accountId: 5035448261,
      customerId: 5017716956,
      status: "active",
      description: "GUNTHER TOOTIES QUQUINCY       M",
      memo: "DBT Purchase",
      type: "directDebit",
      postedDate: 1636369200,
      transactionDate: 1636369200,
      createdDate: 1637100342,
      lastUpdatedDate: 1637601080,
      categorization: {
        normalizedPayeeName: "Gunther Tooties",
        category: "Clothing",
        bestRepresentation: "GUNTHER TOOTIES QUQUINCY DBT PURCHASE",
        country: "USA",
      },
    },
    {
      id: 16703387253,
      amount: -50.0,
      accountId: 5035448261,
      customerId: 5017716956,
      status: "active",
      description: "BOSTONCOLLEGEHIGH HTTPSWWW.BCHIM",
      memo: "DBT Purchase",
      type: "directDebit",
      postedDate: 1636023600,
      transactionDate: 1636023600,
      createdDate: 1637100342,
      categorization: {
        normalizedPayeeName: "Bostoncollegehigh",
        category: "Tuition",
        bestRepresentation: "BOSTONCOLLEGEHIGH HTTPSWWW BCHIM DBT PURCHASE",
        country: "USA",
      },
    },
    {
      id: 16703387255,
      amount: -128.26,
      accountId: 5035448261,
      customerId: 5017716956,
      status: "active",
      description: "CAGNEYS PUB       617-8473940  M",
      memo: "DBT Purchase",
      type: "directDebit",
      postedDate: 1635937200,
      transactionDate: 1635937200,
      createdDate: 1637100342,
      categorization: {
        normalizedPayeeName: "Cagneys Pub",
        category: "Alcohol & Bars",
        bestRepresentation: "CAGNEYS PUB DBT PURCHASE",
        country: "USA",
      },
    },
    {
      id: 16703387254,
      amount: -600.0,
      accountId: 5035448261,
      customerId: 5017716956,
      status: "active",
      description: "Check",
      checkNum: "1144",
      memo: "Check",
      type: "check",
      postedDate: 1635937200,
      transactionDate: 1635937200,
      createdDate: 1637100342,
      categorization: {
        normalizedPayeeName: "check",
        category: "Check",
        bestRepresentation: "CHECK",
        country: "USA",
      },
      ofxCheckNumber: "1144",
    },
  ],
};

const toCsv = async () => {
  const txns = rawTxns.transactions.map(
    ({
      amount,
      description,
      checkNum,
      postedDate,
      createdDate,
      categorization,
      transactionDate,
    }) => ({
      ...categorization,
      amount,
      description,
      checkNum,
      postedDate: new Date(postedDate * 1000),
      createDate: new Date(createdDate * 1000),
      transactionDate: new Date(transactionDate * 1000),
    })
  );
  const res = await jsonexport.default(txns);

  return res;
};

toCsv();
